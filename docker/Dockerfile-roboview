FROM ubuntu:trusty
# https://askubuntu.com/questions/1235271/pygtk-not-available-on-focal-fossa-20-04
# bionic: reduce() of empty sequence with no initial value

ARG DEBIAN_FRONTEND="noninteractive"

#ARG YARP="3.2.2" -> cmake 3.11 (not cmake 3.10)
#ARG YARP="3.2.1" -> rosmsg errors in xenial
#ARG YARP="3.2.0"
ARG YARP="2.3.66"

# Pybind11 "stable" atow forces python3
##ARG PYBIND11_COMMIT="58c382a8e3d7081364d2f5c62e7f429f0412743b"
# Pybind11 2.6.2
ARG PYBIND11_COMMIT="f1abf5d9159b805674197f6bc443592e631c9130"
ENV ROS_PYTHON_VERSION=2

ARG OROCOS_KINEMATICS_DYNAMICS="1.5.1"

RUN apt update \
    && apt install -y --no-install-recommends \
        wget unzip swig cmake build-essential \
        libedit-dev python python-dev libvtk6-dev python-gtk2 python-gtkglext1 \
    \
    && wget -q --no-check-certificate https://github.com/robotology/yarp/archive/refs/tags/v$YARP.tar.gz \
    && tar -xzf v$YARP.tar.gz \
    && mkdir yarp-$YARP/build && cd yarp-$YARP/build \
    && cmake .. -DSKIP_ACE=ON -DYARP_COMPILE_BINDINGS=ON -DCREATE_PYTHON=ON \
    # -DYARP_COMPILE_libYARP_math=OFF -DENABLE_yarpcar_rossrv=OFF -DENABLE_yarpcar_tcpros=OFF -DENABLE_yarpcar_xmlrpc=OFF \
    #    -DCREATE_GUIS=OFF -DYARP_COMPILE_BINDINGS=ON -DCREATE_PYTHON=ON -DCMAKE_INSTALL_PYTHONDIR=/usr/local/lib/python2.7/dist-packages \
    && make -j$(nproc) && make install && cd ../.. && rm v$YARP.tar.gz \
    #\
    # PYBIND11 would be via git submodules, but download directly
    #&& wget -q --no-check-certificate https://github.com/orocos/orocos_kinematics_dynamics/archive/refs/tags/v$OROCOS_KINEMATICS_DYNAMICS.tar.gz \
    #&& tar -xzf v$OROCOS_KINEMATICS_DYNAMICS.tar.gz \
    #&& mkdir orocos_kinematics_dynamics-$OROCOS_KINEMATICS_DYNAMICS/orocos_kdl/build && cd orocos_kinematics_dynamics-$OROCOS_KINEMATICS_DYNAMICS/orocos_kdl/build && cmake .. \
    #&& make -j$(nproc) && make install && cd ../../python_orocos_kdl \
    #&& wget -q --no-check-certificate https://github.com/pybind/pybind11/archive/$PYBIND11_COMMIT.zip \
    #&& unzip $PYBIND11_COMMIT.zip && rmdir pybind11 && mv pybind11-$PYBIND11_COMMIT pybind11 && rm $PYBIND11_COMMIT.zip \
    #&& mkdir build && cd build && cmake .. \
    #&& make -j$(nproc) && make install \
    #&& cd ../../.. && rm v$OROCOS_KINEMATICS_DYNAMICS.tar.gz \
    #\
    #&& ldconfig
